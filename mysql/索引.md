### 索引

#### 分类

##### 1. 聚簇索引

叶子节点存储的是数据行，那么它就是聚簇索引，否则是非聚簇索引

![img](https://static001.geekbang.org/resource/image/b6/c0/b678418551507cf9a91519b524fed0c0.png?wh=1920x1037)

<font color="yellow">**回表**</font>

如果查询一张表用到了索引，数据库会先在索引里面找到主键， 然后再去聚簇索引中找到数据。 数据行是存在磁盘的，因此回表效率低。

##### 2. 覆盖索引

如果查询的列都在某个索引中，数据可以直接返回索引中存储的列，不必回表。

SQL应尽量覆盖索引

* 只查询需要的列
* 针对最频繁的查询来设计覆盖索引



##### 3. 最左匹配原则

执行一个 WHERE A=a1 AND B=b1 AND C=c1 的查询就类似于

```go
for a in A {
  if a == a1 {
    for b in B {
      if b == b1 {
        for c in C {
          if c == c1 {
            // 这就是你要的数据，拿到主键之后去磁盘里面加载出来
          }
        }
      }
    }
  }
}
```

AND 用 OR 不用，正用反不用，范围则中断

* WHERE A = a1 OR B = b1, WHERE A !=a1 不会使用索引
* WHERE A = a1 AND B = b1，WHERE A=a1 AND B > b1 AND C = c1使用两层索引



#### 索引的代价

* 索引存储要要消耗磁盘空间
* 运行时索引被加载到内存中，消耗内存
* 增删改数据时需要同步增删改索引，引入额外的消耗



### 面试点

* mysql为什么使用B+树
* 索引分类
* 最左匹配原则

精辟回答
从数据结构上来说，在 MySQL 里面索引主要是 B+ 树索引。它的查询性能更好，适合范围查询，也适合放在内存里。 

MySQL 的索引又可以从不同的角度进一步划分。比如说根据叶子节点是否包含数据分成聚簇索引和非聚簇索引，还有包含某个查询的所有列的覆盖索引等等。

数据库使用索引遵循最左匹配原则。但是最终数据库会不会用索引，也是一个比较难说的事情，跟查询有关，也跟数据量有关。在实践中，是否使用索引以及使用什么索引，都要以 EXPLAIN 为准。

